{% load static %}
<!doctype html>
<html lang="en" data-user-theme="{{ user_theme|default:'' }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover">
    <title>{% block title %}TEDx Finance Hub{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
        <!-- Performance Optimization: DNS Prefetch -->
        <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
        <!-- Mobile Optimization -->
        <meta name="theme-color" content="#0F172A" media="(prefers-color-scheme: dark)">
        <meta name="theme-color" content="#F8FAFC" media="(prefers-color-scheme: light)">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            scroll-behavior: smooth;
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--text);
            letter-spacing: -0.01em;
        }

        .muted { color: var(--muted); }
        .subtle-border { border: 1px solid var(--border); }

        /* Buttons */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.35rem; border-radius: 0.75rem; font-weight: 700; padding: 0.6rem 1rem; transition: transform 0.12s ease, box-shadow 0.2s ease, background 0.2s ease; }
        .btn:active { transform: translateY(1px); }
        .btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #fff; box-shadow: 0 12px 30px -18px #6366f1; }
        .btn-primary:hover { background: linear-gradient(135deg, #4f46e5, #7c3aed); }
        .btn-ghost { background: rgba(255,255,255,0.04); color: var(--text); border: 1px solid var(--border); }
        .btn-ghost:hover { background: rgba(255,255,255,0.08); }

        html.light-theme .btn-ghost { background: #f1f5f9; color: #1e293b; border: 1px solid #cbd5e1; }
        html.light-theme .btn-ghost:hover { background: #e2e8f0; }

        /* Table surfaces */
        .table-surface { background: rgba(15, 23, 42, 0.6); border: 1px solid var(--border); border-radius: 1rem; overflow: hidden; }
        .table-surface table { width: 100%; border-collapse: collapse; }
        .table-surface thead { background: rgba(30, 41, 59, 0.9); color: #f8fafc; font-size: 0.85rem; letter-spacing: 0.03em; text-transform: uppercase; }
        .table-surface th { padding: 0.85rem 1rem; font-weight: 700; white-space: nowrap; }
        .table-surface td { padding: 0.75rem 1rem; color: #e2e8f0; }
        .table-surface tbody tr { border-bottom: 1px solid rgba(148, 163, 184, 0.12); }
        .table-surface tbody tr:hover { background: rgba(255,255,255,0.03); }
        .table-surface .row-actions { display: flex; flex-wrap: wrap; gap: 0.4rem; }

        html.light-theme .table-surface { background: #ffffff; border: 1px solid #e2e8f0; }
        html.light-theme .table-surface thead { background: #f1f5f9; color: #0f172a; }
        html.light-theme .table-surface td { color: #1e293b; }

        html.light-theme .empty-state { color: #64748b; }
        html.light-theme .empty-state svg { color: #94a3b8; }
        html.light-theme .table-surface tbody tr { border-bottom: 1px solid #e5e7eb; }
        html.light-theme .table-surface tbody tr:hover { background: #f8fafc; }

        /* Empty state */
        .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.5rem; padding: 2.5rem 1.5rem; color: var(--muted); }
        .empty-state svg { width: 40px; height: 40px; color: #94a3b8; }

        /* Theme Tokens - Dark */
        :root {
            --bg: #0b1220;
            --bg-alt: #0f172a;
            --panel: #111a2f;
            --panel-strong: #0f192c;
            --border: rgba(148, 163, 184, 0.14);
            --glow: rgba(79, 70, 229, 0.22);
            --text: #e2e8f0;
            --muted: #94a3b8;
            --accent: #ef4444;
            --accent-2: #22d3ee;
        }

        /* Theme Tokens - Light */
        html.light-theme {
            --bg: #f8fafc;
            --bg-alt: #f1f5f9;
            --panel: #ffffff;
            --panel-strong: #f8fafc;
            --border: rgba(100, 116, 139, 0.2);
            --glow: rgba(99, 102, 241, 0.15);
            --text: #0f172a;
            --muted: #64748b;
            --accent: #ef4444;
            --accent-2: #0ea5e9;
        }
        
        /* Dark Theme (Default) */
        html:not(.light-theme) body {
            background: radial-gradient(circle at 20% 20%, rgba(34, 197, 235, 0.05), transparent 35%),
                        radial-gradient(circle at 80% 0%, rgba(239, 68, 68, 0.06), transparent 40%),
                        linear-gradient(160deg, var(--bg) 0%, var(--bg-alt) 60%, #0b1527 100%);
            color: var(--text);
            min-height: 100vh;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Light Theme */
        html.light-theme body {
            background: linear-gradient(135deg, #F8FAFC 0%, #EEF2FF 50%, #FDF4FF 100%);
            color: #1E293B;
        }

        html.light-theme h1,
        html.light-theme h2,
        html.light-theme h3,
        html.light-theme h4,
        html.light-theme h5,
        html.light-theme h6 {
            color: #0f172a !important;
        }

        html.light-theme .text-white {
            color: #0f172a !important;
        }

        html.light-theme .text-slate-200,
        html.light-theme .text-slate-300,
        html.light-theme .text-slate-400 {
            color: #64748b !important;
        }

        html.light-theme p.text-slate-400,
        html.light-theme span.text-slate-400,
        html.light-theme div.text-slate-400 {
            color: #64748b !important;
        }

        html.light-theme a.text-slate-300 {
            color: #64748b !important;
        }

        html.light-theme a.text-slate-300:hover {
            color: #1e293b !important;
        }

        html.light-theme .bg-slate-700,
        html.light-theme .bg-slate-800 {
            background: #f1f5f9 !important;
        }

        html.light-theme .bg-slate-900 {
            background: #e2e8f0 !important;
        }

        html.light-theme .bg-slate-900\/40 {
            background: #ffffff !important;
        }

        html.light-theme .border-slate-600,
        html.light-theme .border-slate-700 {
            border-color: #cbd5e1 !important;
        }

        html.light-theme .border-slate-700\/50 {
            border-color: #e2e8f0 !important;
        }

        html.light-theme .bg-slate-700\/50 {
            background: #f8fafc !important;
        }

        html.light-theme .border-slate-600 {
            border-color: #cbd5e1 !important;
        }

        /* Settings Page - Dark Theme Improvements */
        .settings-badge,
        span.bg-slate-700.settings-badge {
            background: rgba(99, 102, 241, 0.15) !important;
            color: #a5b4fc !important;
            border: 1px solid rgba(99, 102, 241, 0.3) !important;
        }

        /* Settings Page Light Theme */
        html.light-theme .settings-subtitle {
            color: #64748b !important;
        }

        html.light-theme .settings-heading {
            color: #0f172a !important;
        }

        html.light-theme .settings-badge,
        html.light-theme span.bg-slate-700.settings-badge,
        html.light-theme span.bg-slate-700.text-slate-200.settings-badge {
            background: #818cf8 !important;
            color: #ffffff !important;
            border: 1px solid #6366f1 !important;
            font-weight: 600 !important;
        }

        html.light-theme .settings-badge.text-slate-200 {
            color: #ffffff !important;
        }

        html.light-theme .settings-label {
            color: #1e293b !important;
        }

        html.light-theme .settings-help {
            color: #64748b !important;
        }

        html.light-theme .theme-preview-box {
            background: #f8fafc !important;
            border-color: #e2e8f0 !important;
        }

        html.light-theme .settings-preview-title {
            color: #1e293b !important;
        }

        html.light-theme .settings-preview-text {
            color: #64748b !important;
        }

        html.light-theme .settings-checkbox-label {
            cursor: pointer;
        }

        html.light-theme .settings-checkbox-title {
            color: #1e293b !important;
        }

        html.light-theme .settings-checkbox-help {
            color: #64748b !important;
        }

        html.light-theme .settings-btn-cancel {
            background: #f1f5f9 !important;
            color: #475569 !important;
            border: 1px solid #e2e8f0 !important;
        }

        html.light-theme .settings-btn-cancel:hover {
            background: #e2e8f0 !important;
            color: #1e293b !important;
        }

        html.light-theme a.bg-slate-700.settings-btn-cancel,
        html.light-theme a.bg-slate-700.settings-btn-cancel.text-white {
            background: #f1f5f9 !important;
            color: #475569 !important;
        }

        html.light-theme .settings-btn-save {
            background: #7c3aed !important;
            color: #ffffff !important;
        }

        html.light-theme .settings-btn-save:hover {
            background: #6d28d9 !important;
        }

        /* Form Select Elements in Light Theme */
        html.light-theme select#id_theme {
            background: #ffffff !important;
            color: #1e293b !important;
            border: 2px solid #6366f1 !important;
            font-weight: 500 !important;
        }

        html.light-theme select#id_theme:focus {
            border-color: #4f46e5 !important;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
        }

        /* Settings Page - General Elements Light Theme */
        html.light-theme .settings-page-title {
            color: #0f172a !important;
        }

        html.light-theme .settings-back-link {
            color: #64748b !important;
        }

        html.light-theme .settings-back-link:hover {
            color: #1e293b !important;
        }

        /* Settings Page - Override all dark theme text */
        html.light-theme .text-white,
        html.light-theme h1.text-white,
        html.light-theme h2.text-white,
        html.light-theme h3.text-white,
        html.light-theme h4.text-white,
        html.light-theme span.text-white,
        html.light-theme p.text-white,
        html.light-theme div.text-white,
        html.light-theme label.text-white {
            color: #0f172a !important;
        }

        html.light-theme .text-slate-200,
        html.light-theme .text-slate-300,
        html.light-theme a.text-slate-300,
        html.light-theme p.text-slate-300 {
            color: #475569 !important;
        }

        html.light-theme .text-slate-400,
        html.light-theme p.text-slate-400 {
            color: #64748b !important;
        }

        html.light-theme a.text-slate-300:hover {
            color: #1e293b !important;
        }
        
        html.light-theme nav {
            background: rgba(255, 255, 255, 0.98) !important;
            border-bottom: 1px solid #E0E7FF !important;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1) !important;
        }
        
        html.light-theme .nav-link {
            color: #1E293B !important;
        }
        
        html.light-theme .nav-link:hover {
            color: #6366F1 !important;
            background: linear-gradient(135deg, #EEF2FF 0%, #F5F3FF 100%) !important;
        }
        
        /* Light Theme - Navigation Text Colors */
        html.light-theme nav a {
            color: #1E293B !important;
        }
        
        html.light-theme nav a:hover {
            color: #6366F1 !important;
        }
        
        html.light-theme .nav-menu-item {
            color: #1E293B !important;
        }
        
        html.light-theme .nav-menu-item:hover {
            color: #6366F1 !important;
            background: #EEF2FF !important;
        }
        
        /* Light Theme - User Button */
        html.light-theme [data-user-button] {
            color: #1E293B !important;
        }
        
        html.light-theme [data-user-button]:hover {
            background: #EEF2FF !important;
            color: #6366F1 !important;
        }
        
        html.light-theme [data-user-text] {
            color: #1E293B !important;
        }
        
        html.light-theme .text-slate-300 {
            color: #1E293B !important;
        }
        
        /* Light Theme - User Dropdown Menu */
        html.light-theme #userDropdown {
            background: #FFFFFF !important;
            border: 2px solid #E0E7FF !important;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2) !important;
        }
        
        html.light-theme #userDropdown .border-slate-700 {
            border-color: #E0E7FF !important;
        }
        
        html.light-theme #userDropdown [data-dropdown-link] {
            color: #475569 !important;
        }
        
        html.light-theme #userDropdown [data-dropdown-link]:hover {
            background: #F1F5F9 !important;
            color: #6366F1 !important;
        }
        
        html.light-theme #userDropdown [data-dropdown-text] {
            color: #64748B !important;
        }
        
        html.light-theme #userDropdown .text-white {
            color: #1E293B !important;
        }
        
        /* Light Theme - Mobile Menu */
        html.light-theme #mobileMenu [data-mobile-link] {
            color: #475569 !important;
        }
        
        html.light-theme #mobileMenu [data-mobile-link]:hover {
            background: #F1F5F9 !important;
            color: #6366F1 !important;
        }
        
        /* Light Theme - Export Dropdown */
        html.light-theme .export-dropdown-item {
            color: #1E293B !important;
            background: #FFFFFF !important;
        }
        
        html.light-theme .export-dropdown-item .text-slate-700 {
            color: #1E293B !important;
        }
        
        html.light-theme .export-dropdown-item .text-slate-800 {
            color: #0F172A !important;
        }
        
        html.light-theme .export-dropdown-item .text-slate-500 {
            color: #64748B !important;
        }
        
        html.light-theme .export-dropdown-item:hover {
            color: #1E293B !important;
        }
        
        html.light-theme .export-dropdown-item .border-gray-100 {
            border-color: #E5E7EB !important;
        }
        
        /* Dark Theme - Export Dropdown */
        html:not(.light-theme) .group:hover > div[class*="absolute"] {
            background: #1E293B !important;
            border-color: #10B981 !important;
        }
        
        html:not(.light-theme) .export-dropdown-item {
            background: #1E293B !important;
            color: #E2E8F0 !important;
        }
        
        html:not(.light-theme) .export-dropdown-item:first-child {
            border-color: #334155 !important;
        }
        
        html:not(.light-theme) .export-dropdown-item .border-gray-100 {
            border-color: #334155 !important;
        }
        
        html:not(.light-theme) .export-dropdown-item:hover {
            background: #334155 !important;
        }
        
        html:not(.light-theme) .export-dropdown-item .text-slate-700,
        html:not(.light-theme) .export-dropdown-item .font-semibold {
            color: #E2E8F0 !important;
        }
        
        html:not(.light-theme) .export-dropdown-item .text-slate-800,
        html:not(.light-theme) .export-dropdown-item .font-bold {
            color: #F1F5F9 !important;
        }
        
        html:not(.light-theme) .export-dropdown-item .text-slate-500,
        html:not(.light-theme) .export-dropdown-item .text-xs {
            color: #94A3B8 !important;
        }
        
        /* Light Theme - Metric Cards with Vibrant Colors */
        html.light-theme .metric-card,
        html.light-theme .section-card {
            background: #FFFFFF !important;
            border: 2px solid #E0E7FF !important;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.08) !important;
        }
        
        html.light-theme .metric-card:hover,
        html.light-theme .section-card:hover {
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.15) !important;
            border-color: #C7D2FE !important;
        }
        
        /* Light Theme - Text Colors */
        html.light-theme .text-white {
            color: #1E293B !important;
        }
        
        html.light-theme h1.text-white,
        html.light-theme h2.text-white,
        html.light-theme h3.text-white {
            color: #0F172A !important;
            font-weight: 800 !important;
        }
        
        html.light-theme .text-slate-300 {
            color: #475569 !important;
        }
        
        html.light-theme .text-slate-400 {
            color: #64748B !important;
        }
        
        html.light-theme .text-slate-500 {
            color: #64748B !important;
        }
        
        html.light-theme .text-slate-600 {
            color: #475569 !important;
        }
        
        html.light-theme .text-slate-700 {
            color: #334155 !important;
        }
        
        html.light-theme .text-slate-800 {
            color: #1E293B !important;
        }
        
        html.light-theme .text-slate-900 {
            color: #0F172A !important;
        }
        
        /* Light Theme - Additional common text patterns */
        html.light-theme p.text-white,
        html.light-theme span.text-white,
        html.light-theme div.text-white,
        html.light-theme label.text-white {
            color: #0F172A !important;
        }
        
        html.light-theme .font-semibold.text-white,
        html.light-theme .font-bold.text-white {
            color: #0F172A !important;
            font-weight: 700 !important;
        }
        
        /* Light Theme - Background text on cards */
        html.light-theme .bg-slate-800\/50 .text-white,
        html.light-theme .bg-slate-700\/50 .text-white {
            color: #1E293B !important;
        }
        
        /* Light Theme - Metric card large numbers */
        html.light-theme .text-5xl.text-white,
        html.light-theme .text-4xl.text-white,
        html.light-theme .text-3xl.text-white,
        html.light-theme .text-2xl.text-white,
        html.light-theme .text-xl.text-white,
        html.light-theme .text-lg.text-white {
            color: #0F172A !important;
        }
        
        /* Light Theme - Links */
        html.light-theme .text-slate-400 {
            color: #64748B !important;
        }
        
        html.light-theme a.text-slate-400:hover {
            color: #334155 !important;
        }
        
        /* Light Theme - Green (Total Funds) */
        html.light-theme .text-green-400 {
            color: #059669 !important;
        }
        
        html.light-theme .bg-green-500\/10 {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%) !important;
        }
        
        html.light-theme .border-green-500\/20 {
            border-color: #6EE7B7 !important;
        }
        
        html.light-theme .bg-green-500\/20 {
            background: #A7F3D0 !important;
        }
        
        /* Light Theme - Orange (Funds Spent) */
        html.light-theme .text-orange-400 {
            color: #EA580C !important;
        }
        
        html.light-theme .bg-orange-500\/10 {
            background: linear-gradient(135deg, #FFEDD5 0%, #FED7AA 100%) !important;
        }
        
        html.light-theme .border-orange-500\/20 {
            border-color: #FDB96A !important;
        }
        
        html.light-theme .bg-orange-500\/20 {
            background: #FED7AA !important;
        }
        
        /* Light Theme - Cyan (Remaining) */
        html.light-theme .text-cyan-400 {
            color: #0891B2 !important;
        }
        
        html.light-theme .bg-cyan-500\/10 {
            background: linear-gradient(135deg, #CFFAFE 0%, #A5F3FC 100%) !important;
        }
        
        html.light-theme .border-cyan-500\/20 {
            border-color: #67E8F9 !important;
        }
        
        html.light-theme .bg-cyan-500\/20 {
            background: #A5F3FC !important;
        }
        
        /* Light Theme - Card Backgrounds */
        html.light-theme .bg-slate-800\/50 {
            background: #FFFFFF !important;
            border: 2px solid #E0E7FF !important;
        }
        
        html.light-theme .bg-slate-700\/50 {
            background: #F8FAFC !important;
            border: 1px solid #E2E8F0 !important;
        }
        
        /* Light Theme - Subtle cards (e.g., burn rate boxes) */
        html.light-theme .bg-slate-700\/30 {
            background: #FFFFFF !important;
            border: 1px solid #E2E8F0 !important;
        }
        html.light-theme .hover\:bg-slate-700\/30:hover {
            background: #F1F5F9 !important;
        }
        
        html.light-theme .bg-slate-700 {
            background: #F1F5F9 !important;
            color: #1E293B !important;
        }
        
        html.light-theme .bg-slate-800 {
            background: #F8FAFC !important;
            color: #1E293B !important;
        }
        
        html.light-theme .border-slate-600,
        html.light-theme .border-slate-700 {
            border-color: #CBD5E1 !important;
        }
        html.light-theme .border-slate-600\/50,
        html.light-theme .border-slate-700\/50 {
            border-color: #E2E8F0 !important;
        }
        
        /* Light Theme - Form Inputs */
        html.light-theme input,
        html.light-theme select,
        html.light-theme textarea {
            background-color: #FFFFFF !important;
            border-color: #C7D2FE !important;
            color: #1E293B !important;
        }
        
        html.light-theme input:focus,
        html.light-theme select:focus,
        html.light-theme textarea:focus {
            border-color: #818CF8 !important;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
        }
        
        html.light-theme .bg-slate-900\/50 {
            background: #FFFFFF !important;
            color: #1E293B !important;
        }
        
        /* Light Theme - Alert boxes */
        html.light-theme .bg-red-900\/50 {
            background: #FEE2E2 !important;
            border-color: #DC2626 !important;
            color: #991B1B !important;
        }
        
        html.light-theme .bg-yellow-500 {
            background: #EAB308 !important;
            color: #FFFFFF !important;
        }
        
        /* Light Theme - Status badges */
        html.light-theme .bg-green-900 {
            background: #d1fae5 !important;
            color: #065f46 !important;
        }

        html.light-theme .bg-yellow-900 {
            background: #fef3c7 !important;
            color: #78350f !important;
        }

        html.light-theme .bg-red-900\/50 {
            background: #fee2e2 !important;
            border-color: #dc2626 !important;
            color: #7f1d1d !important;
        }

        html.light-theme .bg-yellow-900\/50 {
            background: #fef3c7 !important;
            border-color: #f59e0b !important;
            color: #78350f !important;
        }

        html.light-theme .bg-green-900\/30 {
            background: #d1fae5 !important;
            border-color: #10b981 !important;
            color: #065f46 !important;
        }

        html.light-theme .bg-red-900\/30 {
            background: #fee2e2 !important;
            border-color: #dc2626 !important;
            color: #991b1b !important;
        }

        html.light-theme .bg-cyan-900\/30 {
            background: #cffafe !important;
            border-color: #06b6d4 !important;
            color: #164e63 !important;
        }

        html.light-theme .text-green-300,
        html.light-theme .text-green-400 {
            color: #047857 !important;
        }

        html.light-theme .text-yellow-300,
        html.light-theme .text-yellow-400 {
            color: #d97706 !important;
        }

        html.light-theme .text-cyan-400 {
            color: #0891b2 !important;
        }

        html.light-theme .text-red-200,
        html.light-theme .text-red-300,
        html.light-theme .text-red-400 {
            color: #dc2626 !important;
        }

        html.light-theme .text-yellow-100,
        html.light-theme .text-yellow-200 {
            color: #92400e !important;
        }
        
        /* Light Theme - Gradient Title */
        html.light-theme .bg-gradient-to-r.from-red-500 {
            background: linear-gradient(90deg, #DC2626 0%, #DB2777 50%, #7C3AED 100%) !important;
            -webkit-background-clip: text !important;
            background-clip: text !important;
        }
        
        /* Light Theme - Chart Section Icons */
        html.light-theme .bg-purple-500\/20 {
            background: linear-gradient(135deg, #EDE9FE 0%, #DDD6FE 100%) !important;
        }
        
        html.light-theme .text-purple-400 {
            color: #7C3AED !important;
        }
        
        html.light-theme .bg-blue-500\/20 {
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%) !important;
        }
        
        html.light-theme .text-blue-400 {
            color: #2563EB !important;
        }
        
        html.light-theme .bg-indigo-500\/20 {
            background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%) !important;
        }
        
        html.light-theme .text-indigo-400 {
            color: #4F46E5 !important;
        }
        
        html.light-theme .bg-yellow-500\/20 {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%) !important;
        }
        
        html.light-theme .text-yellow-400 {
            color: #D97706 !important;
        }
        
        /* Light Theme - Action Buttons (keep gradients vibrant) */
        html.light-theme .bg-gradient-to-r.from-red-600 {
            background: linear-gradient(90deg, #DC2626 0%, #DB2777 100%) !important;
        }
        
        html.light-theme .bg-gradient-to-r.from-purple-600 {
            background: linear-gradient(90deg, #9333EA 0%, #DB2777 100%) !important;
        }
        
        html.light-theme .bg-gradient-to-r.from-indigo-600 {
            background: linear-gradient(90deg, #4F46E5 0%, #7C3AED 100%) !important;
        }
        
        html.light-theme .bg-blue-600 {
            background: #2563EB !important;
        }
        
        html.light-theme .bg-green-600 {
            background: #059669 !important;
        }
        
        html.light-theme .bg-red-600 {
            background: #DC2626 !important;
        }
        
        html.light-theme .bg-purple-600 {
            background: #9333EA !important;
        }
        
        html.light-theme .bg-amber-600 {
            background: #D97706 !important;
        }
        
        html.light-theme .bg-slate-600 {
            background: #475569 !important;
        }
        
        html.light-theme .bg-slate-700 {
            background: #334155 !important;
        }
        
        /* Light Theme - Disabled Buttons */
        html.light-theme button:disabled,
        html.light-theme button.disabled\:opacity-50:disabled {
            opacity: 0.4 !important;
            cursor: not-allowed !important;
        }
        
        /* Light Theme - Button Text (always white for visibility) */
        html.light-theme a[class*="bg-gradient"],
        html.light-theme a[class*="bg-blue-"],
        html.light-theme a[class*="bg-green-"],
        html.light-theme a[class*="bg-red-"],
        html.light-theme a[class*="bg-purple-"],
        html.light-theme a[class*="bg-amber-"],
        html.light-theme a[class*="bg-slate-"],
        html.light-theme button[class*="bg-blue-"],
        html.light-theme button[class*="bg-green-"],
        html.light-theme button[class*="bg-red-"],
        html.light-theme button[class*="bg-purple-"],
        html.light-theme button[class*="bg-amber-"] {
            color: #FFFFFF !important;
        }
        
        /* Light Theme - Button SVG icons */
        html.light-theme a[class*="bg-gradient"] svg,
        html.light-theme a[class*="bg-blue-"] svg,
        html.light-theme a[class*="bg-green-"] svg,
        html.light-theme a[class*="bg-red-"] svg,
        html.light-theme a[class*="bg-purple-"] svg,
        html.light-theme a[class*="bg-amber-"] svg,
        html.light-theme a[class*="bg-slate-"] svg {
            color: #FFFFFF !important;
            stroke: #FFFFFF !important;
        }
        
        /* Light Theme - Hover color transitions */
        html.light-theme .hover\:text-white:hover {
            color: #0F172A !important;
        }
        
        html.light-theme .group-hover\:text-indigo-400,
        html.light-theme .group-hover\:text-yellow-400,
        html.light-theme .group-hover\:text-green-400 {
            transition: color 0.3s ease;
        }
        
        /* Light Theme - Charts and data visualization */
        html.light-theme canvas {
            background: transparent !important;
        }
        
        /* Light Theme - Scrollbars */
        html.light-theme .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #CBD5E1 !important;
        }
        
        html.light-theme .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94A3B8 !important;
        }
        
        /* Light Theme - Border colors */
        html.light-theme .border-red-600 {
            border-color: #DC2626 !important;
        }
        
        html.light-theme .border-green-400,
        html.light-theme .border-red-400,
        html.light-theme .border-yellow-500\/20 {
            border-color: #D1D5DB !important;
        }
        
        /* Light Theme - Additional text color fixes for form pages */
        html.light-theme .text-slate-300 {
            color: #334155 !important;
        }
        
        html.light-theme p.text-slate-300,
        html.light-theme div.text-slate-300,
        html.light-theme span.text-slate-300 {
            color: #334155 !important;
        }
        
        html.light-theme .text-blue-300 {
            color: #1E40AF !important;
            font-weight: 600 !important;
        }
        
        html.light-theme .text-blue-400 {
            color: #2563EB !important;
        }
        
        /* Light Theme - Info boxes and alerts */
        html.light-theme .bg-blue-900 {
            background: #DBEAFE !important;
            border-color: #93C5FD !important;
        }
        
        html.light-theme .border-blue-700 {
            border-color: #93C5FD !important;
        }
        
        /* Light Theme - Small help text */
        html.light-theme .text-xs.text-slate-400,
        html.light-theme p.text-xs.text-slate-400 {
            color: #64748B !important;
        }
        
        html.light-theme .text-sm.text-slate-300,
        html.light-theme p.text-sm.text-slate-300 {
            color: #475569 !important;
        }
        
        /* Light Theme - Gradient card backgrounds */
        html.light-theme .bg-gradient-to-br.from-slate-800\/60 {
            background: #FFFFFF !important;
            border: 1px solid #E2E8F0 !important;
        }
        
        html.light-theme .section-card {
            background: #FFFFFF !important;
            border: 1px solid #E2E8F0 !important;
        }
        
        /* Navigation */
        nav {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.92), rgba(15, 22, 35, 0.92));
            backdrop-filter: blur(16px);
            border-bottom: 1px solid var(--border);
            box-shadow: 0 15px 40px -20px var(--glow);
        }

        nav .nav-link,
        nav .nav-menu-item,
        nav a.nav-link,
        nav a.nav-menu-item,
        nav a.rounded-lg,
        nav a[class*="rounded"],
        nav button.rounded-lg {
            color: var(--text) !important;
            background-color: transparent !important;
            background-image: none !important;
            background: none !important;
            transition: all 0.2s ease;
        }

        nav .nav-link:hover,
        nav .nav-menu-item:hover,
        nav a.nav-link:hover,
        nav a.nav-menu-item:hover,
        nav a.rounded-lg:hover,
        nav a[class*="rounded"]:hover,
        nav button.rounded-lg:hover,
        nav .hover\:bg-slate-700:hover {
            background: rgba(255, 255, 255, 0.08) !important;
            background-color: rgba(255, 255, 255, 0.08) !important;
            color: #f8fafc !important;
        }

        html.light-theme nav {
            background: rgba(255, 255, 255, 0.98);
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            backdrop-filter: blur(20px);
        }

        html.light-theme nav .nav-link,
        html.light-theme nav .nav-menu-item,
        html.light-theme nav a.nav-link,
        html.light-theme nav a.nav-menu-item,
        html.light-theme nav a.rounded-lg,
        html.light-theme nav a[class*="rounded"],
        html.light-theme nav button.rounded-lg {
            color: #475569 !important;
            font-weight: 500;
            background: none !important;
            background-color: transparent !important;
            background-image: none !important;
        }

        html.light-theme nav .nav-link:hover,
        html.light-theme nav .nav-menu-item:hover,
        html.light-theme nav a.nav-link:hover,
        html.light-theme nav a.nav-menu-item:hover,
        html.light-theme nav a.rounded-lg:hover,
        html.light-theme nav a[class*="rounded"]:hover,
        h

        /* Force remove backgrounds from all nav links */
        nav a[data-nav-link],
        html.light-theme nav a[data-nav-link] {
            background: transparent !important;
            background-color: transparent !important;
        }

        nav a[data-nav-link]:hover {
            background: rgba(255, 255, 255, 0.08) !important;
            background-color: rgba(255, 255, 255, 0.08) !important;
        }

        html.light-theme nav a[data-nav-link]:hover {
            background: #f1f5f9 !important;
            background-color: #f1f5f9 !important;
        }

        /* Ultra-specific light theme nav overrides */
        html.light-theme nav a.px-4.py-2.rounded-lg,
        html.light-theme nav a.px-4.py-2.rounded-lg.hover\:bg-slate-700,
        html.light-theme nav .hidden.md\:flex a {
            background: transparent !important;
            background-color: transparent !important;
            background-image: none !important;
        }

        html.light-theme nav a.px-4.py-2.rounded-lg:hover,
        html.light-theme nav a.px-4.py-2.rounded-lg.hover\:bg-slate-700:hover,
        html.light-theme nav .hidden.md\:flex a:hover {
            background: #f1f5f9 !important;
            background-color: #f1f5f9 !important;
        }tml.light-theme nav button.rounded-lg:hover,
        html.light-theme nav .hover\:bg-slate-700:hover {
            background: #f1f5f9 !important;
            background-color: #f1f5f9 !important;
            color: #1e293b !important;
        }

        html.light-theme nav .text-red-500 {
            color: #ef4444 !important;
        }

        html.light-theme nav .text-white {
            color: #0f172a !important;
        }

        html.light-theme nav .hover\:bg-slate-700:hover {
            background: #f1f5f9 !important;
        }

        html.light-theme nav .text-slate-300 {
            color: #64748b !important;
        }

        html.light-theme nav .text-slate-300:hover {
            color: #1e293b !important;
        }

        html.light-theme nav a.text-slate-300 svg {
            color: #64748b !important;
            stroke: #64748b !important;
        }

        html.light-theme nav a.text-slate-300:hover svg {
            color: #1e293b !important;
            stroke: #1e293b !important;
        }

        html.light-theme nav svg {
            color: #64748b !important;
            stroke: #64748b !important;
        }

        html.light-theme nav button:hover svg,
        html.light-theme nav a:hover svg {
            color: #1e293b !important;
            stroke: #1e293b !important;
        }

        html.light-theme nav .bg-red-600 {
            background: #dc2626 !important;
            color: #ffffff !important;
        }

        html.light-theme nav #userDropdown {
            background: #ffffff !important;
            border-color: #e2e8f0 !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
        }

        html.light-theme nav #userDropdown .border-slate-700 {
            border-color: #e2e8f0 !important;
        }

        html.light-theme nav #userDropdown [data-dropdown-link] {
            color: #475569 !important;
        }

        html.light-theme nav #userDropdown [data-dropdown-link]:hover {
            background: #f8fafc !important;
            color: #1e293b !important;
        }

        html.light-theme nav #userDropdown .text-slate-400 {
            color: #94a3b8 !important;
        }

        html.light-theme nav #userDropdown .text-red-400 {
            color: #ef4444 !important;
        }
        
        .nav-link {
            transition: all 0.2s ease;
        }
        
        .nav-link:hover {
            transform: translateY(-1px);
        }
        
        /* Cards */
        .metric-card,
        .section-card {
            background: radial-gradient(circle at 10% 10%, rgba(34, 197, 235, 0.08), transparent 35%),
                        radial-gradient(circle at 80% 0%, rgba(239, 68, 68, 0.08), transparent 40%),
                        linear-gradient(145deg, var(--panel-strong), var(--panel));
            backdrop-filter: blur(14px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 16px 40px -24px var(--glow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .metric-card:hover,
        .section-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 22px 44px -20px var(--glow);
            border-color: rgba(99, 102, 241, 0.55);
        }

        html.light-theme .metric-card,
        html.light-theme .section-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        html.light-theme .metric-card:hover,
        html.light-theme .section-card:hover {
            border-color: #c7d2fe;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .slide-in-left {
            animation: slideInRight 0.6s ease-out forwards;
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s ease-out 0.2s forwards;
            opacity: 0;
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #6366F1 0%, #8B5CF6 100%);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #4F46E5 0%, #7C3AED 100%);
        }
        
        html.light-theme .custom-scrollbar::-webkit-scrollbar-track {
            background: #F1F5F9;
        }
        
        html.light-theme .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #818CF8 0%, #A78BFA 100%);
        }
        
        html.light-theme .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #6366F1 0%, #8B5CF6 100%);
        }
        
        /* Messages */
        .message {
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideInRight 0.4s ease-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.15);
        }
        
        .message-success {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
        }
        
        .message-warning {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
        }
        
        .message-error {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
        }
        
        .message-info {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
        }
        
        /* Buttons */
        button,
        .btn,
        a[class*="bg-"]:not(.metric-card):not(.section-card) {
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        button:hover,
        .btn:hover,
        a[class*="bg-"]:not(.metric-card):not(.section-card):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }
        
        button:active,
        .btn:active,
        a[class*="bg-"]:not(.metric-card):not(.section-card):active {
            transform: translateY(0);
        }
        
        /* Form inputs */
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #6366F1 !important;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.7);
        }
        
        html.light-theme ::-webkit-scrollbar-track {
            background: #F1F5F9;
        }
        
        html.light-theme ::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.3);
        }
        
        html.light-theme ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.5);
        }
        
            /* ========== MOBILE RESPONSIVENESS ========== */
        
            /* Ensure touch targets are at least 44x44px (iOS guidelines) */
            @media (max-width: 768px) {
                button, a, input[type="submit"], input[type="button"], 
                select, input[type="checkbox"], input[type="radio"] {
                    min-height: 44px !important;
                    min-width: 44px !important;
                }
            
                /* Larger padding for mobile buttons */
                .btn, button:not(.user-menu-button) {
                    padding: 12px 20px !important;
                }
            
                /* Prevent text zoom on input focus in iOS */
                input, select, textarea {
                    font-size: 16px !important;
                }
            
                /* Better mobile menu spacing */
                #mobileMenu {
                    padding-left: 8px;
                    padding-right: 8px;
                }
            
                #mobileMenu a, #mobileMenu button {
                    padding: 14px 16px !important;
                    margin: 4px 0;
                    font-size: 15px;
                }
            
                /* Mobile-optimized navigation */
                nav {
                    padding: 8px 0;
                }
            
                /* Reduce header size on mobile */
                h1 {
                    font-size: 2rem !important;
                    line-height: 1.2 !important;
                }
            
                h2 {
                    font-size: 1.5rem !important;
                }
            
                h3 {
                    font-size: 1.25rem !important;
                }
            
                /* Card spacing for mobile */
                .metric-card, .section-card {
                    margin-bottom: 12px;
                    padding: 16px !important;
                }
            
                /* Better table responsiveness */
                table {
                    display: block;
                    overflow-x: auto;
                    -webkit-overflow-scrolling: touch;
                }
            
                /* Stack form inputs on mobile */
                form .flex-wrap > * {
                    flex-basis: 100% !important;
                    max-width: 100% !important;
                }
            
                /* Horizontal scroll for charts on mobile */
                .chart-container {
                    overflow-x: auto;
                    -webkit-overflow-scrolling: touch;
                }
            }
        
            /* Tablet breakpoint */
            @media (min-width: 769px) and (max-width: 1024px) {
                .container {
                    padding-left: 24px;
                    padding-right: 24px;
                }
            }
        
            /* ========== ACCESSIBILITY IMPROVEMENTS ========== */
        
            /* Focus visible for keyboard navigation */
            *:focus-visible {
                outline: 3px solid #6366F1 !important;
                outline-offset: 2px !important;
                border-radius: 4px;
            }
        
            html.light-theme *:focus-visible {
                outline-color: #4F46E5 !important;
            }
        
            /* Skip to main content link */
            .skip-link {
                position: absolute;
                top: -40px;
                left: 0;
                background: #6366F1;
                color: white;
                padding: 8px 16px;
                text-decoration: none;
                border-radius: 0 0 4px 0;
                font-weight: 600;
                z-index: 9999;
            }
        
            .skip-link:focus {
                top: 0;
            }
        
            /* High contrast mode support */
            @media (prefers-contrast: high) {
                * {
                    border-width: 2px !important;
                }
            
                button, .btn, a[class*="bg-"] {
                    border: 2px solid currentColor !important;
                }
            }
        
            /* Reduced motion for users who prefer it */
            @media (prefers-reduced-motion: reduce) {
                *,
                *::before,
                *::after {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                    scroll-behavior: auto !important;
                }
            }
        
            /* Screen reader only content */
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border-width: 0;
            }
        
            /* Better link contrast in light mode */
            html.light-theme a {
                color: #4F46E5;
            }
        
            html.light-theme a:hover {
                color: #6366F1;
            }
        
            /* Ensure sufficient color contrast for text */
            html.light-theme .text-slate-400 {
                color: #475569 !important;
            }
        
            html.light-theme .text-slate-500 {
                color: #334155 !important;
            }
        
            /* ========== PERFORMANCE OPTIMIZATIONS ========== */
        
            /* Enable GPU acceleration for animations */
            .metric-card, .section-card, button, .btn {
                will-change: transform;
                transform: translateZ(0);
            }
        
            /* Lazy load images */
            img {
                content-visibility: auto;
            }
        
            /* Optimize font rendering */
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                text-rendering: optimizeLegibility;
            }
        
            /* Contain layout shifts */
            .chart-container canvas {
                width: 100% !important;
                height: auto !important;
                aspect-ratio: 16 / 9;
            }
            
            /* ========== MOBILE RESPONSIVENESS ENHANCEMENTS ========== */
            
            /* Mobile-first touch targets (minimum 44x44px) */
            @media (max-width: 768px) {
                button, a.btn, input[type="submit"], input[type="checkbox"], input[type="radio"] {
                    min-height: 44px;
                    min-width: 44px;
                }
                
                /* Improve tap targets for action buttons */
                button svg, a svg {
                    pointer-events: none;
                }
                
                /* Better spacing for mobile cards */
                .section-card {
                    padding: 1rem !important;
                }
                
                /* Optimize mobile metrics display */
                .metric-card {
                    padding: 1.25rem !important;
                }
                
                /* Mobile-friendly table scrolling hint */
                .overflow-x-auto::after {
                    content: ' Swipe to scroll ';
                    display: block;
                    text-align: center;
                    color: #94A3B8;
                    font-size: 0.75rem;
                    padding: 0.5rem;
                    margin-top: 0.5rem;
                    opacity: 0.7;
                }
                
                /* Improve mobile form inputs */
                input[type="text"],
                input[type="number"],
                input[type="email"],
                input[type="password"],
                input[type="date"],
                select,
                textarea {
                    font-size: 16px !important; /* Prevents iOS zoom on focus */
                    padding: 0.75rem !important;
                }
                
                /* Mobile navigation improvements */
                nav {
                    position: sticky;
                    top: 0;
                    z-index: 100;
                }
                
                /* Better mobile spacing */
                .container, .max-w-7xl, .max-w-6xl, .max-w-4xl {
                    padding-left: 1rem !important;
                    padding-right: 1rem !important;
                }
                
                /* Prevent horizontal scroll */
                body {
                    overflow-x: hidden;
                }
                
                /* Mobile-optimized modals */
                .modal {
                    margin: 0.5rem;
                    max-height: calc(100vh - 1rem);
                }
            }
            
            /* Tablet-specific optimizations */
            @media (min-width: 768px) and (max-width: 1024px) {
                .section-card {
                    padding: 1.5rem !important;
                }
                
                /* Better chart sizing for tablets */
                .chart-container {
                    height: 350px !important;
                }
            }
            
            /* Touch device optimizations */
            @media (hover: none) and (pointer: coarse) {
                /* Remove hover effects on touch devices */
                .hover\:scale-105:hover {
                    transform: scale(1);
                }
                
                /* Add active states for touch feedback */
                button:active, .btn:active, a:active {
                    transform: scale(0.98);
                    transition: transform 0.1s ease;
                }
                
                /* Larger click areas for touch */
                .nav-link {
                    padding: 0.75rem 1rem !important;
                }
            }
            
            /* Landscape mobile optimization */
            @media (max-width: 768px) and (orientation: landscape) {
                /* Reduce vertical padding in landscape */
                .section-card {
                    padding-top: 0.75rem !important;
                    padding-bottom: 0.75rem !important;
                }
                
                nav {
                    padding-top: 0.5rem;
                    padding-bottom: 0.5rem;
                }
            }
            
            /* Safe area insets for notched devices */
            @supports (padding: max(0px)) {
                body {
                    padding-left: max(0px, env(safe-area-inset-left));
                    padding-right: max(0px, env(safe-area-inset-right));
                }
                
                nav {
                    padding-left: max(1rem, env(safe-area-inset-left));
                    padding-right: max(1rem, env(safe-area-inset-right));
                }
            }
            
            /* Accessibility improvements for mobile */
            @media (prefers-reduced-motion: reduce) {
                *,
                *::before,
                *::after {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                }
            }
    </style>
</head>
<body>
        <!-- Skip to main content for accessibility -->
        <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Navigation -->
        <nav class="sticky top-0 z-50" role="navigation" aria-label="Main navigation">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <a href="{% url 'tedx_finance:dashboard' %}" class="flex items-center space-x-3 nav-link px-2">
                    <span class="text-2xl font-bold text-red-500">TEDx</span>
                    <span class="text-lg font-semibold text-white">Finance Hub</span>
                </a>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-2" id="desktopNav">
                    {% if user.is_authenticated %}
                        <a href="{% url 'tedx_finance:dashboard' %}" 
                           class="nav-link nav-menu-item px-4 py-2 rounded-lg hover:bg-slate-700"
                           data-nav-link>
                             Dashboard
                        </a>
                        <a href="{% url 'tedx_finance:transactions_table' %}" 
                           class="nav-link nav-menu-item px-4 py-2 rounded-lg hover:bg-slate-700"
                           data-nav-link>
                             Transactions
                        </a>
                        <a href="{% url 'tedx_finance:budgets' %}" 
                           class="nav-link nav-menu-item px-4 py-2 rounded-lg hover:bg-slate-700"
                           data-nav-link>
                             Budgets
                        </a>
                        {% if is_treasurer %}
                        <a href="{% url 'tedx_finance:manage_categories' %}" 
                           class="nav-link nav-menu-item px-4 py-2 rounded-lg hover:bg-slate-700"
                           data-nav-link>
                             Categories
                        </a>
                        {% endif %}
                        <a href="{% url 'tedx_finance:budget_suggestions' %}" 
                           class="nav-link nav-menu-item px-4 py-2 rounded-lg hover:bg-slate-700"
                           data-nav-link>
                             Predictions
                        </a>
                        <a href="{% url 'tedx_finance:proof_gallery' %}" 
                           class="nav-link nav-menu-item px-4 py-2 rounded-lg hover:bg-slate-700"
                           data-nav-link>
                             Proofs
                        </a>
                        <a href="{% url 'tedx_finance:settings' %}"
                           class="nav-link nav-menu-item px-4 py-2 rounded-lg hover:bg-slate-700"
                           data-nav-link>
                             Settings
                        </a>
                        
                        <!-- Notifications Bell -->
                        <a href="{% url 'tedx_finance:notifications_list' %}" 
                           class="relative nav-link text-slate-300 px-4 py-2 rounded-lg hover:bg-slate-700 transition-colors group"
                           title="View notifications">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                            </svg>
                            <span id="unread-count-badge" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center" style="display: none;">0</span>
                        </a>
                        
                        <!-- User Menu -->
                        <div class="relative group ml-2">
                            <button class="flex items-center space-x-2 nav-link text-slate-300 px-4 py-2 rounded-lg hover:bg-slate-700" data-user-button>
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                <span data-user-text>{{ user.username }}</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </button>
                            
                            <div class="absolute right-0 mt-2 w-56 bg-slate-800 border border-slate-700 rounded-xl shadow-xl py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200" id="userDropdown" role="menu" aria-label="User dropdown menu">
                                <div class="px-4 py-3 border-b border-slate-700">
                                    <p class="text-xs text-slate-400" data-dropdown-text>Signed in as</p>
                                    <p class="text-sm font-semibold text-white" data-dropdown-text>{{ user.username }}</p>
                                </div>
                                
                                {% if is_treasurer %}
                                <a href="/admin/" class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700" data-dropdown-link role="menuitem" aria-label="Admin Panel">
                                     Admin Panel
                                </a>
                                {% endif %}

                                <a href="{% url 'tedx_finance:settings' %}" class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700" data-dropdown-link role="menuitem" aria-label="Settings">
                                     Settings
                                </a>
                                
                                <button onclick="toggleTheme()" class="w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-700" data-dropdown-link role="menuitem" aria-label="Toggle theme">
                                     Toggle Theme
                                </button>
                                
                                <hr class="border-slate-700 my-2">
                                
                                <form method="post" action="{% url 'logout' %}">
                                    {% csrf_token %}
                                    <button type="submit" class="w-full text-left block px-4 py-2 text-sm text-red-400 hover:bg-slate-700" data-dropdown-link role="menuitem" aria-label="Logout">
                                         Logout
                                    </button>
                                </form>
                            </div>
                        </div>
                    {% else %}
                        <a href="{% url 'login' %}" class="nav-link text-slate-300 px-4 py-2 rounded-lg hover:bg-slate-700" aria-label="Login">
                            Login
                        </a>
                        <a href="{% url 'tedx_finance:signup' %}" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700" aria-label="Sign Up">
                            Sign Up
                        </a>
                    {% endif %}
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                        <button onclick="toggleMobileMenu()" 
                                class="text-slate-300 hover:text-white p-2" 
                                aria-label="Toggle mobile menu"
                                aria-expanded="false"
                                aria-controls="mobileMenu">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <title>Menu Icon</title>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
                    <div id="mobileMenu" 
                          class="hidden md:hidden pb-4 space-y-2" 
                          role="menu" 
                          aria-label="Mobile navigation menu">
                {% if user.is_authenticated %}
                              <a href="{% url 'tedx_finance:dashboard' %}" 
                                  class="block px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                  data-mobile-link
                                  role="menuitem">
                         Dashboard
                    </a>
                              <a href="{% url 'tedx_finance:transactions_table' %}" 
                                  class="block px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                  data-mobile-link
                                  role="menuitem">
                         Transactions
                    </a>
                              <a href="{% url 'tedx_finance:budgets' %}" 
                                  class="block px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                  data-mobile-link
                                  role="menuitem">
                         Budgets
                    </a>
                              {% if is_treasurer %}
                              <a href="{% url 'tedx_finance:manage_categories' %}" 
                                  class="block px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                  data-mobile-link
                                  role="menuitem">
                         Categories
                    </a>
                              {% endif %}
                              <a href="{% url 'tedx_finance:budget_suggestions' %}" 
                                  class="block px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                  data-mobile-link
                                  role="menuitem">
                         Predictions
                    </a>
                              <a href="{% url 'tedx_finance:proof_gallery' %}" 
                                  class="block px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                  data-mobile-link
                                  role="menuitem">
                         Proofs
                    </a>
                              <a href="{% url 'tedx_finance:settings' %}" 
                                  class="block px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                  data-mobile-link
                                  role="menuitem">
                         Settings
                    </a>
                    <hr class="border-slate-700 my-2">
                    {% if is_treasurer %}
                              <a href="/admin/" 
                                  class="block px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                  data-mobile-link
                                  role="menuitem">
                         Admin Panel
                    </a>
                    {% endif %}
                              <button onclick="toggleTheme()" 
                                         class="w-full text-left px-4 py-2 text-slate-300 hover:bg-slate-700 rounded-lg" 
                                         data-mobile-link
                                         role="menuitem"
                                         aria-label="Toggle theme">
                         Toggle Theme
                    </button>
                              <form method="post" action="{% url 'logout' %}">
                                  {% csrf_token %}
                                  <button type="submit" 
                                          class="w-full text-left block px-4 py-2 text-red-400 hover:bg-slate-700 rounded-lg" 
                                          data-mobile-link
                                          role="menuitem">
                                       Logout
                                  </button>
                              </form>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Messages -->
    {% if messages %}
        <div class="container mx-auto px-4 pt-6" role="alert" aria-live="polite">
        {% for message in messages %}
        <div class="message message-{{ message.tags }}">
            <span>{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main Content -->
        <main id="main-content" class="container mx-auto px-4 py-8" role="main">
        {% block content %}
        {% endblock %}
        </main>

    <!-- Scripts -->
    <script>
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
                const button = document.querySelector('[aria-controls="mobileMenu"]');
            menu.classList.toggle('hidden');
            
                // Update aria-expanded for accessibility
                if (button) {
                    const isExpanded = !menu.classList.contains('hidden');
                    button.setAttribute('aria-expanded', isExpanded.toString());
                }
        }

        // Theme toggle with proper persistence
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = localStorage.getItem('theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            if (newTheme === 'light') {
                html.classList.add('light-theme');
                updateNavColors('light');
            } else {
                html.classList.remove('light-theme');
                updateNavColors('dark');
            }
            
            // Save to localStorage
            localStorage.setItem('theme', newTheme);
            
            // Also save to session/cookie to prevent server override
            try {
                document.cookie = `theme=${newTheme}; path=/; max-age=31536000; SameSite=Lax`;
            } catch(e) {
                console.log('Could not set cookie');
            }
        }

        // Update navigation link colors based on theme
        function updateNavColors(theme) {
            // Use multiple selectors for reliability
            const navLinks = document.querySelectorAll('[data-nav-link], .nav-menu-item');
            const dropdownLinks = document.querySelectorAll('[data-dropdown-link], [data-mobile-link]');
            const dropdownTexts = document.querySelectorAll('[data-dropdown-text]');
            const userButton = document.querySelector('[data-user-button]');
            const userText = document.querySelector('[data-user-text]');
            
            const lightColor = '#1E293B';
            const darkColor = '#CBD5E1';
            const lightDropdownColor = '#475569';
            const darkDropdownColor = '#CBD5E1';
            
            // Update main navigation links
            navLinks.forEach(link => {
                if (theme === 'light') {
                    link.style.setProperty('color', lightColor, 'important');
                    link.setAttribute('data-theme-color', 'light');
                } else {
                    link.style.setProperty('color', darkColor, 'important');
                    link.setAttribute('data-theme-color', 'dark');
                }
            });
            
            // Update dropdown and mobile menu links
            dropdownLinks.forEach(link => {
                if (theme === 'light') {
                    link.style.setProperty('color', lightDropdownColor, 'important');
                } else {
                    link.style.setProperty('color', darkDropdownColor, 'important');
                }
            });
            
            // Update dropdown text elements
            dropdownTexts.forEach(text => {
                if (theme === 'light') {
                    text.style.setProperty('color', '#64748B', 'important');
                } else {
                    text.style.setProperty('color', '#CBD5E1', 'important');
                }
            });
            
            // Update user button and text
            if (userButton) {
                userButton.style.setProperty('color', theme === 'light' ? lightColor : darkColor, 'important');
            }
            if (userText) {
                userText.style.setProperty('color', theme === 'light' ? lightColor : darkColor, 'important');
            }
            
            // Also update via CSS variable as backup
            document.documentElement.style.setProperty('--nav-text-color', theme === 'light' ? lightColor : darkColor);
        }

        // Load saved theme on page load - RUNS IMMEDIATELY BEFORE DOM LOADS
        (function() {
            const html = document.documentElement;
            
            // ALWAYS prioritize localStorage - this is the user's active choice
            let storedTheme = localStorage.getItem('theme');
            
            // If no localStorage, check cookie as backup
            if (!storedTheme) {
                const cookieMatch = document.cookie.match(/theme=([^;]+)/);
                if (cookieMatch) {
                    storedTheme = cookieMatch[1];
                    localStorage.setItem('theme', storedTheme);
                }
            }
            
            // Final fallback to server theme or dark
            const activeTheme = storedTheme || html.dataset.userTheme || 'dark';
            
            // Apply immediately
            if (activeTheme === 'light') {
                html.classList.add('light-theme');
            } else {
                html.classList.remove('light-theme');
            }
            
            // Update nav colors immediately and after DOM loads
            updateNavColors(activeTheme);
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    updateNavColors(activeTheme);
                });
            } else {
                updateNavColors(activeTheme);
            }
        })();

        // Add fade-in animation to cards
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.metric-card, .section-card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('fade-in');
            });
            
            // Fetch unread notifications count
            updateNotificationBadge();
        });
        
        // Update notification badge with unread count
        function updateNotificationBadge() {
            fetch('/notifications/api/unread/')
                .then(response => response.json())
                .then(data => {
                    const badge = document.getElementById('unread-count-badge');
                    if (badge) {
                        if (data.unread_count > 0) {
                            badge.textContent = data.unread_count > 99 ? '99+' : data.unread_count;
                            badge.style.display = 'flex';
                        } else {
                            badge.style.display = 'none';
                        }
                    }
                })
                .catch(error => console.error('Error fetching notifications:', error));
        }
        
        // Poll for notification updates every 30 seconds
        setInterval(updateNotificationBadge, 30000);
    </script>

    <!-- Custom JavaScript Utilities -->
    <script src="{% static 'js/utils.js' %}"></script>
    <script src="{% static 'js/transactions.js' %}"></script>
    <script src="{% static 'js/ui-enhancements.js' %}"></script>
</body>
</html>
